<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:Nalu.Maui.Sample.PageModels"
             xmlns:nalu="https://nalu-development.github.com/nalu/layouts"
             xmlns:maui="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Maui"
             x:Class="Nalu.Maui.Sample.Pages.TwelvePage"
             x:DataType="pageModels:TwelvePageModel"
             Title="Credit Cards Comparison">
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,*">
            <!-- Toggle Buttons -->
            <Grid Grid.Row="0"
                  ColumnDefinitions="*,*,*"
                  Padding="8"
                  BackgroundColor="LightGray">
                <Button Grid.Column="0"
                        Text="None"
                        Command="{Binding ShowNoneCommand}"
                        Margin="4,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="BackgroundColor" Value="LightGray" />
                            <Setter Property="TextColor" Value="Black" />
                            <Style.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsNoneSelected}"
                                             Value="True">
                                    <Setter Property="BackgroundColor" Value="#4A90E2" />
                                    <Setter Property="TextColor" Value="White" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Grid.Column="1"
                        Text="CollectionView (MAUI)"
                        Command="{Binding ShowCollectionViewCommand}"
                        Margin="4,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="BackgroundColor" Value="LightGray" />
                            <Setter Property="TextColor" Value="Black" />
                            <Style.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsCollectionViewSelected}"
                                             Value="True">
                                    <Setter Property="BackgroundColor" Value="#4A90E2" />
                                    <Setter Property="TextColor" Value="White" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Grid.Column="2"
                        Text="VirtualScroll (Nalu)"
                        Command="{Binding ShowVirtualScrollCommand}"
                        Margin="4,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="BackgroundColor" Value="LightGray" />
                            <Setter Property="TextColor" Value="Black" />
                            <Style.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsVirtualScrollSelected}"
                                             Value="True">
                                    <Setter Property="BackgroundColor" Value="#4A90E2" />
                                    <Setter Property="TextColor" Value="White" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>

            <!-- Auto Scroll Button -->
            <Button Grid.Row="1"
                    Text="Start auto scroll"
                    Command="{Binding StartAutoScrollCommand}"
                    Margin="8,4"
                    HorizontalOptions="Center" />

            <!-- ToggleTemplate for CollectionView and VirtualScroll -->
            <nalu:ToggleTemplate Grid.Row="2"
                                 Value="{Binding ViewMode}">
                <nalu:ToggleTemplate.WhenTrue>
                    <DataTemplate x:DataType="pageModels:TwelvePageModel">
                        <CollectionView ItemsSource="{Binding Groups}"
                                        IsGrouped="True">
                            <CollectionView.GroupHeaderTemplate>
                                <DataTemplate x:DataType="pageModels:TwelveGroup">
                                    <Grid BackgroundColor="#4A90E2"
                                          Padding="16,12">
                                        <Label Text="{Binding OwnerName}"
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center" />
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.GroupHeaderTemplate>
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="pageModels:TwelveCreditCard">
                                    <Border Margin="8"
                                            VerticalOptions="Center"
                                            StrokeThickness="0"
                                            StrokeShape="RoundRectangle 8"
                                            Style="{StaticResource CardStyle}">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <Border Grid.Column="0"
                                                    Margin="4"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 8">
                                                <maui:CachedImage Source="{Binding ImageSource}"
                                                                  HeightRequest="48"
                                                                  WidthRequest="60"
                                                                  Aspect="AspectFill" />
                                            </Border>
                                            <VerticalStackLayout Grid.Column="1"
                                                                 VerticalOptions="Center">
                                                <FlexLayout Direction="Row"
                                                            Wrap="NoWrap">
                                                    <Label FontSize="16"
                                                           FontFamily="OpenSansSemibold"
                                                           MaxLines="1"
                                                           FlexLayout.Shrink="1"
                                                           LineBreakMode="TailTruncation"
                                                           Text="{Binding Name}" />
                                                    <Image IsVisible="{Binding Starred}"
                                                           Source="{FontImageSource FontFamily=MaterialFilled, Size=16, Glyph='&#xf0ec;', Color={StaticResource Primary}}" />
                                                </FlexLayout>
                                                <Label FontSize="12">
                                                    <Label.FormattedText>
                                                        <FormattedString>
                                                            <Span Text="{Binding Type}" />
                                                            <Span Text=" · " />
                                                            <Span Text="{Binding Exp}" />
                                                        </FormattedString>
                                                    </Label.FormattedText>
                                                </Label>
                                            </VerticalStackLayout>
                                            <Label Grid.Column="2"
                                                   FontSize="18"
                                                   Background="{StaticResource Secondary}"
                                                   TextColor="{StaticResource PrimaryDark}"
                                                   FontFamily="OpenSansSemibold"
                                                   Padding="8"
                                                   VerticalTextAlignment="Center"
                                                   Text="{Binding CreditDollar}">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding StarUnstarCommand}" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </DataTemplate>
                </nalu:ToggleTemplate.WhenTrue>
                <nalu:ToggleTemplate.WhenFalse>
                    <DataTemplate x:DataType="pageModels:TwelvePageModel">
                        <nalu:VirtualScroll Adapter="{Binding Adapter}">
                            <nalu:VirtualScroll.HeaderTemplate>
                                <DataTemplate x:DataType="pageModels:TwelvePageModel">
                                    <nalu:ViewBox ContentBindingContext="{x:Static pageModels:TwelvePageStaticModel.Instance}">
                                        <Label Text="{Binding Message}"
                                               x:DataType="pageModels:TwelvePageStaticModel"
                                               BackgroundColor="Red"/>
                                    </nalu:ViewBox>
                                </DataTemplate>
                            </nalu:VirtualScroll.HeaderTemplate>

                            <!-- Section Header Template -->
                            <nalu:VirtualScroll.SectionHeaderTemplate>
                                <DataTemplate x:DataType="pageModels:TwelveGroup">
                                    <nalu:ViewBox>
                                        <Grid BackgroundColor="#4A90E2"
                                              Padding="16,12">
                                            <Label Text="{Binding OwnerName}"
                                                   FontSize="24"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </nalu:ViewBox>
                                </DataTemplate>
                            </nalu:VirtualScroll.SectionHeaderTemplate>

                            <!-- Item Template -->
                            <nalu:VirtualScroll.ItemTemplate>
                                <DataTemplate x:DataType="pageModels:TwelveCreditCard">
                                    <nalu:ViewBox>
                                        <Border Margin="8"
                                                VerticalOptions="Center"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 8"
                                                Style="{StaticResource CardStyle}">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                <Border Grid.Column="0"
                                                        Margin="4"
                                                        StrokeThickness="0"
                                                        StrokeShape="RoundRectangle 8">
                                                    <maui:CachedImage Source="{Binding ImageSource}"
                                                                      HeightRequest="48"
                                                                      WidthRequest="60"
                                                                      Aspect="AspectFill" />
                                                </Border>
                                                <VerticalStackLayout Grid.Column="1"
                                                                     VerticalOptions="Center">
                                                    <FlexLayout Direction="Row"
                                                                Wrap="NoWrap">
                                                        <Label FontSize="16"
                                                               FontFamily="OpenSansSemibold"
                                                               MaxLines="1"
                                                               FlexLayout.Shrink="1"
                                                               LineBreakMode="TailTruncation"
                                                               Text="{Binding Name}" />
                                                        <Image IsVisible="{Binding Starred}"
                                                               Source="{FontImageSource FontFamily=MaterialFilled, Size=16, Glyph='&#xf0ec;', Color={StaticResource Primary}}" />
                                                    </FlexLayout>
                                                    <Label FontSize="12">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding Type}" />
                                                                <Span Text=" · " />
                                                                <Span Text="{Binding Exp}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </VerticalStackLayout>
                                                <Label Grid.Column="2"
                                                       FontSize="18"
                                                       Background="{StaticResource Secondary}"
                                                       TextColor="{StaticResource PrimaryDark}"
                                                       FontFamily="OpenSansSemibold"
                                                       Padding="8"
                                                       VerticalTextAlignment="Center"
                                                       Text="{Binding CreditDollar}">
                                                    <Label.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding StarUnstarCommand}" />
                                                    </Label.GestureRecognizers>
                                                </Label>
                                            </Grid>
                                        </Border>
                                    </nalu:ViewBox>
                                </DataTemplate>
                            </nalu:VirtualScroll.ItemTemplate>
                        </nalu:VirtualScroll>
                    </DataTemplate>
                </nalu:ToggleTemplate.WhenFalse>
            </nalu:ToggleTemplate>
        </Grid>
    </ContentPage.Content>
</ContentPage>
